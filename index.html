<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misery Index - Football Recruit Travel Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a24;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --accent-green: #10b981;
            --accent-yellow: #f59e0b;
            --accent-red: #ef4444;
            --accent-blue: #3b82f6;
            --border-color: #2d2d3a;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        
        header { text-align: center; margin-bottom: 2rem; }
        
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #fff 0%, #9ca3af 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle { color: var(--text-secondary); font-size: 1.1rem; margin-bottom: 1.5rem; }
        
        .hometown-input {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            background: var(--bg-card);
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            border: 1px solid var(--border-color);
            margin: 0 auto;
            width: fit-content;
        }
        
        .hometown-input svg { width: 18px; height: 18px; color: var(--accent-blue); }
        .hometown-input span { color: var(--text-secondary); }
        .hometown-input strong { color: var(--text-primary); }
        
        /* Team Selector */
        .team-selector {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }
        
        .selector-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .selector-title { font-size: 1.25rem; font-weight: 600; }
        
        .conference-tabs {
            display: flex;
            gap: 0.5rem;
        }
        
        .conf-tab {
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        .conf-tab:hover { border-color: var(--text-secondary); }
        .conf-tab.active { background: var(--text-primary); color: var(--bg-primary); }
        
        .teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 0.75rem;
        }
        
        .team-btn {
            padding: 0.75rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            text-align: center;
        }
        
        .team-btn:hover { border-color: var(--text-secondary); transform: translateY(-1px); }
        .team-btn.selected { border-width: 2px; }
        
        /* Results Section */
        .results-section { display: none; }
        .results-section.visible { display: block; }
        
        .team-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .team-logo {
            width: 64px;
            height: 64px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            font-weight: bold;
            color: white;
        }
        
        .team-info h2 { font-size: 1.5rem; margin-bottom: 0.25rem; }
        .team-info .conf { color: var(--text-secondary); font-size: 0.875rem; }
        
        .misery-overview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--bg-card);
            padding: 1.25rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
            text-align: center;
        }
        
        .stat-label { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; }
        .stat-value { font-size: 1.75rem; font-weight: 700; margin-top: 0.25rem; }
        .stat-value.low { color: var(--accent-green); }
        .stat-value.medium { color: var(--accent-yellow); }
        .stat-value.high { color: var(--accent-red); }
        
        /* Map */
        .map-container {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }
        
        #travelMap { height: 400px; border-radius: 0.75rem; }
        
        .map-legend {
            display: flex;
            gap: 1.5rem;
            margin-top: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .legend-item { display: flex; align-items: center; gap: 0.5rem; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; }
        .legend-line { width: 20px; height: 3px; border-radius: 2px; }
        
        /* Schedule Table */
        .schedule-container {
            background: var(--bg-card);
            border-radius: 1rem;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        
        .schedule-title {
            padding: 1rem 1.5rem;
            font-weight: 600;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }
        
        .schedule-row {
            display: grid;
            grid-template-columns: 80px 1fr 90px 90px 80px 80px 70px;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            align-items: center;
            font-size: 0.875rem;
        }
        
        .schedule-row:last-child { border-bottom: none; }
        .schedule-row.header { background: var(--bg-secondary); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-secondary); }
        
        .opponent-cell { display: flex; align-items: center; gap: 0.5rem; }
        
        .type-badge {
            font-size: 0.6rem;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-weight: 600;
        }
        .type-badge.home { background: var(--accent-green); }
        .type-badge.away { background: var(--accent-red); }
        .type-badge.neutral { background: var(--accent-yellow); color: #000; }
        
        .totals-row { background: var(--bg-secondary); font-weight: 600; }
        
        @media (max-width: 900px) {
            .misery-overview { grid-template-columns: repeat(2, 1fr); }
            .schedule-row { grid-template-columns: 70px 1fr 70px 70px; font-size: 0.75rem; }
            .schedule-row > *:nth-child(4),
            .schedule-row > *:nth-child(5),
            .schedule-row > *:nth-child(6) { display: none; }
            .teams-grid { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Misery Index</h1>
            <p class="subtitle">How painful is it for your family to follow you?</p>
            <div class="hometown-input">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <span>Hometown:</span> <strong>Chatsworth, CA</strong>
            </div>
        </header>

        <section class="team-selector">
            <div class="selector-header">
                <div class="selector-title">Select a Team</div>
                <div class="conference-tabs">
                    <button class="conf-tab active" data-conf="SEC">SEC</button>
                    <button class="conf-tab" data-conf="Big Ten">Big Ten</button>
                </div>
            </div>
            <div class="teams-grid" id="teamsGrid">
                <!-- Populated by JS -->
            </div>
        </section>

        <section class="results-section" id="resultsSection">
            <div class="team-header">
                <div class="team-logo" id="teamLogo">TEX</div>
                <div class="team-info">
                    <h2 id="teamName">Texas Longhorns</h2>
                    <div class="conf" id="teamConf">SEC</div>
                </div>
            </div>

            <div class="misery-overview">
                <div class="stat-card">
                    <div class="stat-label">Misery Score</div>
                    <div class="stat-value high" id="miseryScore">78</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Miles</div>
                    <div class="stat-value" id="totalMiles">22,280</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Season Cost</div>
                    <div class="stat-value" id="totalCost">$14,200</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Flights Required</div>
                    <div class="stat-value" id="flightsRequired">12</div>
                </div>
            </div>

            <div class="map-container">
                <div id="travelMap"></div>
                <div class="map-legend">
                    <div class="legend-item"><div class="legend-dot" style="background: #10b981;"></div> Chatsworth (Home)</div>
                    <div class="legend-item"><div class="legend-line" style="background: currentColor;"></div> Home Stadium</div>
                    <div class="legend-item"><div class="legend-line" style="background: currentColor; opacity: 0.5;"></div> Away Games</div>
                </div>
            </div>

            <div class="schedule-container">
                <div class="schedule-title">2026 Season Schedule</div>
                <div id="scheduleTable">
                    <!-- Populated by JS -->
                </div>
            </div>
        </section>
    </div>

    <script src="teams-data.js"></script>
    <script>
        // State
        let selectedTeam = null;
        let currentConference = 'SEC';
        let map = null;
        let mapLayers = [];

        // Home location: Chatsworth, CA
        const HOME = { lat: 34.2572, lng: -118.6006 };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderTeamGrid('SEC');
            setupEventListeners();
        });

        function setupEventListeners() {
            // Conference tabs
            document.querySelectorAll('.conf-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.conf-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentConference = tab.dataset.conf;
                    renderTeamGrid(currentConference);
                });
            });
        }

        function renderTeamGrid(conference) {
            const grid = document.getElementById('teamsGrid');
            const teams = Object.entries(TEAMS).filter(([id, team]) => team.conference === conference);
            
            grid.innerHTML = teams.map(([id, team]) => `
                <button class="team-btn ${selectedTeam === id ? 'selected' : ''}" 
                        data-team="${id}" 
                        style="${selectedTeam === id ? 'border-color: ' + team.color + '; background: ' + team.color + '20;' : ''}"
                        onclick="selectTeam('${id}')">
                    ${team.name}
                </button>
            `).join('');
        }

        function selectTeam(teamId) {
            selectedTeam = teamId;
            const team = TEAMS[teamId];
            const stadium = STADIUMS[teamId];
            const schedule = SCHEDULES[teamId];

            if (!schedule) {
                alert('Schedule not yet available for this team');
                return;
            }

            // Update team header
            document.getElementById('teamLogo').textContent = team.abbr;
            document.getElementById('teamLogo').style.background = team.color;
            document.getElementById('teamName').textContent = `${team.name} ${team.mascot}`;
            document.getElementById('teamConf').textContent = team.conference;

            // Calculate stats
            const stats = calculateStats(teamId, schedule);
            
            // Update stats
            document.getElementById('miseryScore').textContent = stats.miseryScore;
            document.getElementById('miseryScore').className = 'stat-value ' + (stats.miseryScore < 40 ? 'low' : stats.miseryScore < 70 ? 'medium' : 'high');
            document.getElementById('totalMiles').textContent = stats.totalMiles.toLocaleString();
            document.getElementById('totalCost').textContent = '$' + stats.totalCost.toLocaleString();
            document.getElementById('flightsRequired').textContent = stats.flights;

            // Render schedule
            renderSchedule(teamId, schedule);

            // Render map
            renderMap(teamId, schedule);

            // Show results
            document.getElementById('resultsSection').classList.add('visible');

            // Update team grid to show selection
            renderTeamGrid(currentConference);
        }

        function calculateStats(teamId, schedule) {
            const homeStadium = STADIUMS[teamId];
            let totalMiles = 0;
            let totalCost = 0;
            let flights = 0;

            schedule.forEach(game => {
                const location = STADIUMS[game.location];
                if (location) {
                    totalMiles += location.distance * 2; // Round trip
                    totalCost += location.cost;
                    if (location.distance > 100) flights++;
                }
            });

            // Misery score: weighted combination of miles, cost, and flights
            const miseryScore = Math.min(100, Math.round(
                (totalMiles / 500) + (totalCost / 500) + (flights * 3)
            ));

            return { totalMiles, totalCost, flights, miseryScore };
        }

        function renderSchedule(teamId, schedule) {
            const team = TEAMS[teamId];
            let html = `
                <div class="schedule-row header">
                    <div>Date</div>
                    <div>Opponent</div>
                    <div>To Airport</div>
                    <div>Flight</div>
                    <div>To Stadium</div>
                    <div>Total</div>
                    <div>Cost</div>
                </div>
            `;

            let totalCost = 0;
            let totalMiles = 0;
            let flights = 0;

            schedule.forEach(game => {
                const location = STADIUMS[game.location];
                if (!location) return;

                const isLocal = location.distance < 100;
                totalCost += location.cost;
                totalMiles += location.distance * 2;
                if (!isLocal) flights++;

                const toAirport = isLocal ? '-' : '45 min to LAX';
                const totalHours = parseFloat(location.totalTime) || 0;

                html += `
                    <div class="schedule-row" style="${isLocal ? 'opacity: 0.7;' : ''}">
                        <div>${game.date}</div>
                        <div class="opponent-cell">
                            <span class="type-badge ${game.type}">${game.type.toUpperCase()}</span>
                            ${game.opponent}
                        </div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">${toAirport}</div>
                        <div style="font-size: 0.75rem;">${location.flight || '-'}</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">${location.toStadium}</div>
                        <div style="font-weight: 600; color: ${isLocal ? 'var(--accent-green)' : totalHours > 7 ? 'var(--accent-red)' : 'var(--accent-yellow)'};">${location.totalTime}</div>
                        <div>$${location.cost}</div>
                    </div>
                `;
            });

            html += `
                <div class="schedule-row totals-row">
                    <div></div>
                    <div>SEASON TOTAL</div>
                    <div></div>
                    <div>${flights} flights</div>
                    <div></div>
                    <div>${totalMiles.toLocaleString()} mi</div>
                    <div>$${totalCost.toLocaleString()}</div>
                </div>
            `;

            document.getElementById('scheduleTable').innerHTML = html;
        }

        function renderMap(teamId, schedule) {
            const team = TEAMS[teamId];
            const homeStadium = STADIUMS[teamId];

            // Clear existing map
            if (map) {
                map.remove();
            }

            // Initialize map
            map = L.map('travelMap', {
                center: [38, -98],
                zoom: 4,
                zoomControl: true,
                attributionControl: false
            });

            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                maxZoom: 19
            }).addTo(map);

            // Home marker (Chatsworth)
            const homeIcon = L.divIcon({
                className: 'home-marker',
                html: '<div style="width: 14px; height: 14px; background: #10b981; border-radius: 50%; border: 3px solid #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.5);"></div>',
                iconSize: [14, 14],
                iconAnchor: [7, 7]
            });

            L.marker([HOME.lat, HOME.lng], { icon: homeIcon })
                .bindPopup('<strong>Chatsworth, CA</strong><br>Hometown')
                .addTo(map);

            // Team home stadium line (thick)
            if (homeStadium && homeStadium.lat) {
                const homeLine = L.polyline(
                    createArc([HOME.lat, HOME.lng], [homeStadium.lat, homeStadium.lng], 20),
                    { color: team.color, weight: 4, opacity: 0.8 }
                ).addTo(map);

                const stadiumIcon = L.divIcon({
                    className: 'stadium-marker',
                    html: `<div style="width: 14px; height: 14px; background: ${team.color}; border-radius: 3px; border: 2px solid #fff; transform: rotate(45deg);"></div>`,
                    iconSize: [14, 14],
                    iconAnchor: [7, 7]
                });

                L.marker([homeStadium.lat, homeStadium.lng], { icon: stadiumIcon })
                    .bindPopup(`<strong>${homeStadium.name}</strong><br>${homeStadium.city}<br>Home Stadium`)
                    .addTo(map);
            }

            // Away game lines (dashed)
            schedule.forEach(game => {
                if (game.type === 'home') return;
                
                const location = STADIUMS[game.location];
                if (!location || !location.lat) return;

                const line = L.polyline(
                    createArc([HOME.lat, HOME.lng], [location.lat, location.lng], 20),
                    { color: team.color, weight: 2, opacity: 0.5, dashArray: '5, 10' }
                ).addTo(map);

                const destIcon = L.divIcon({
                    className: 'dest-marker',
                    html: `<div style="width: 8px; height: 8px; background: ${team.color}; border-radius: 50%; border: 2px solid #fff;"></div>`,
                    iconSize: [8, 8],
                    iconAnchor: [4, 4]
                });

                L.marker([location.lat, location.lng], { icon: destIcon })
                    .bindPopup(`<strong>${location.name}</strong><br>${location.city}<br>${game.type === 'neutral' ? 'Neutral Site' : 'Away Game'}`)
                    .addTo(map);
            });
        }

        function createArc(start, end, numPoints) {
            const latlngs = [];
            for (let i = 0; i <= numPoints; i++) {
                const t = i / numPoints;
                const lat = start[0] + (end[0] - start[0]) * t;
                const lng = start[1] + (end[1] - start[1]) * t;
                const curve = Math.sin(t * Math.PI) * 2;
                latlngs.push([lat + curve * 0.3, lng]);
            }
            return latlngs;
        }
    </script>
</body>
</html>
