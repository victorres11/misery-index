<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misery Index - Football Recruit Travel Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a24;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --accent-green: #10b981;
            --accent-yellow: #f59e0b;
            --accent-red: #ef4444;
            --accent-blue: #3b82f6;
            --border-color: #2d2d3a;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        
        header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #fff 0%, #9ca3af 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle { color: var(--text-secondary); font-size: 1.1rem; }
        
        .hometown-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg-card);
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            margin-top: 1rem;
            border: 1px solid var(--border-color);
        }
        
        .hometown-badge svg { width: 18px; height: 18px; color: var(--accent-blue); }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .school-card {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .school-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
        }
        
        .school-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; }
        
        .school-logo {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }
        
        .school-name { font-size: 1.25rem; font-weight: 600; }
        .school-conf { font-size: 0.875rem; color: var(--text-secondary); }
        
        .team-selector {
            width: 100%;
            padding: 0.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
            margin-top: 0.5rem;
        }
        
        .team-selector:focus {
            outline: none;
            border-color: var(--accent-blue);
        }
        
        .baseline-badge {
            font-size: 0.625rem;
            padding: 0.2rem 0.5rem;
            background: var(--accent-green);
            border-radius: 4px;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .misery-score {
            text-align: center;
            padding: 1.5rem;
            background: var(--bg-secondary);
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
        }
        
        .misery-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        
        .misery-value { font-size: 3rem; font-weight: 700; }
        .misery-value.low { color: var(--accent-green); }
        .misery-value.medium { color: var(--accent-yellow); }
        .misery-value.high { color: var(--accent-red); }
        
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        
        .stat-item { background: var(--bg-secondary); padding: 1rem; border-radius: 0.5rem; }
        .stat-label { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; }
        .stat-value { font-size: 1.25rem; font-weight: 600; margin-top: 0.25rem; }
        
        .section-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; }
        
        .map-section { margin-bottom: 3rem; }
        
        .map-container {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }
        
        .map-tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        
        .map-tab {
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .map-tab:hover { border-color: var(--text-secondary); }
        .map-tab.active { border-color: currentColor; color: #fff; background: rgba(255, 255, 255, 0.1); }
        
        #travelMap { height: 500px; border-radius: 0.75rem; background: var(--bg-secondary); }
        
        .map-legend {
            display: flex;
            gap: 1.5rem;
            margin-top: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .legend-item { display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: var(--text-secondary); }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; }
        
        .charts-section { margin-bottom: 3rem; }
        .charts-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; }
        .chart-card {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }
        .chart-title { font-size: 1rem; font-weight: 500; margin-bottom: 1rem; color: var(--text-secondary); }
        
        .comparison-section {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid var(--border-color);
            margin-bottom: 3rem;
        }
        
        .comparison-header { text-align: center; margin-bottom: 2rem; }
        .comparison-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; }
        .comparison-subtitle { color: var(--text-secondary); font-size: 0.875rem; }
        
        .bar-comparison { margin-bottom: 1.5rem; }
        .bar-label { display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.875rem; flex-wrap: wrap; gap: 0.5rem; }
        
        .bar-track {
            height: 32px;
            background: var(--bg-secondary);
            border-radius: 0.5rem;
            display: flex;
            overflow: hidden;
        }
        
        .bar-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            color: #fff;
            transition: width 0.5s ease-out;
            min-width: 40px;
        }
        
        .schedule-section { margin-bottom: 3rem; }
        .schedule-tabs { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; }
        
        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .tab-btn:hover { border-color: var(--text-secondary); }
        .tab-btn.active { background: var(--text-primary); color: var(--bg-primary); border-color: var(--text-primary); }
        
        .schedule-table {
            background: var(--bg-card);
            border-radius: 1rem;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        
        .schedule-row {
            display: grid;
            grid-template-columns: 80px 1fr 100px 100px 90px 90px 80px;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            align-items: center;
            font-size: 0.875rem;
        }
        
        .schedule-row:last-child { border-bottom: none; }
        .schedule-row.header {
            background: var(--bg-secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .opponent-cell { display: flex; align-items: center; gap: 0.75rem; }
        
        .away-badge, .home-badge, .neutral-badge {
            font-size: 0.625rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
        }
        .away-badge { background: var(--accent-red); }
        .home-badge { background: var(--accent-green); }
        .neutral-badge { background: var(--accent-yellow); color: #000; }
        
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        @media (max-width: 1024px) {
            .summary-grid { grid-template-columns: 1fr; }
            .charts-grid { grid-template-columns: 1fr; }
            .schedule-row {
                grid-template-columns: 70px 1fr 70px 60px !important;
                font-size: 0.75rem;
                padding: 0.5rem;
            }
            .schedule-row > *:nth-child(3),
            .schedule-row > *:nth-child(4),
            .schedule-row > *:nth-child(5) { display: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Misery Index</h1>
            <p class="subtitle">How painful is it for your family to follow you?</p>
            <div class="hometown-badge">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <span>Hometown: <strong>Chatsworth, CA</strong></span>
            </div>
        </header>

        <section class="summary-grid">
            <!-- UCLA Card (Fixed Baseline) -->
            <div class="school-card" id="card-ucla">
                <div class="school-header">
                    <div class="school-logo" id="logo-ucla" style="background: #2d68c4;">UCLA</div>
                    <div>
                        <div class="school-name">
                            UCLA Bruins
                            <span class="baseline-badge">BASELINE</span>
                        </div>
                        <div class="school-conf">Big Ten Conference</div>
                    </div>
                </div>
                <div class="misery-score">
                    <div class="misery-label">Season Misery Score</div>
                    <div class="misery-value low" id="score-ucla">24</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Total Miles</div>
                        <div class="stat-value" id="miles-ucla">6,892</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Flights Needed</div>
                        <div class="stat-value" id="flights-ucla">4</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Est. Cost</div>
                        <div class="stat-value" id="cost-ucla">$4,200</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Home Games</div>
                        <div class="stat-value" id="home-ucla" style="color: var(--accent-green);">35 min </div>
                    </div>
                </div>
            </div>

            <!-- Team 2 Card (Selectable) -->
            <div class="school-card" id="card-team2">
                <div class="school-header">
                    <div class="school-logo" id="logo-team2" style="background: #bf5700;">TEX</div>
                    <div style="flex: 1;">
                        <div class="school-name" id="name-team2">Texas Longhorns</div>
                        <div class="school-conf" id="conf-team2">SEC</div>
                        <select class="team-selector" id="selector-team2" onchange="updateTeam('team2', this.value)">
                            <optgroup label="SEC">
                                <option value="alabama">Alabama</option>
                                <option value="arkansas">Arkansas</option>
                                <option value="auburn">Auburn</option>
                                <option value="florida">Florida</option>
                                <option value="georgia">Georgia</option>
                                <option value="kentucky">Kentucky</option>
                                <option value="lsu">LSU</option>
                                <option value="mississippi-state">Mississippi State</option>
                                <option value="missouri">Missouri</option>
                                <option value="oklahoma">Oklahoma</option>
                                <option value="ole-miss">Ole Miss</option>
                                <option value="south-carolina">South Carolina</option>
                                <option value="tennessee">Tennessee</option>
                                <option value="texas" selected>Texas</option>
                                <option value="texas-am">Texas A&M</option>
                                <option value="vanderbilt">Vanderbilt</option>
                            </optgroup>
                            <optgroup label="Big Ten">
                                <option value="illinois">Illinois</option>
                                <option value="indiana">Indiana</option>
                                <option value="iowa">Iowa</option>
                                <option value="maryland">Maryland</option>
                                <option value="michigan">Michigan</option>
                                <option value="michigan-state">Michigan State</option>
                                <option value="minnesota">Minnesota</option>
                                <option value="nebraska">Nebraska</option>
                                <option value="northwestern">Northwestern</option>
                                <option value="ohio-state">Ohio State</option>
                                <option value="oregon">Oregon</option>
                                <option value="penn-state">Penn State</option>
                                <option value="purdue">Purdue</option>
                                <option value="rutgers">Rutgers</option>
                                <option value="usc">USC</option>
                                <option value="washington">Washington</option>
                                <option value="wisconsin">Wisconsin</option>
                            </optgroup>
                        </select>
                    </div>
                </div>
                <div class="misery-score">
                    <div class="misery-label">Season Misery Score</div>
                    <div class="misery-value high" id="score-team2">78</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Total Miles</div>
                        <div class="stat-value" id="miles-team2">22,280</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Flights Needed</div>
                        <div class="stat-value" id="flights-team2">12</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Est. Cost</div>
                        <div class="stat-value" id="cost-team2">$14,200</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Home Games</div>
                        <div class="stat-value" id="home-team2" style="color: var(--accent-yellow);">7  3h 锔</div>
                    </div>
                </div>
            </div>

            <!-- Team 3 Card (Selectable) -->
            <div class="school-card" id="card-team3">
                <div class="school-header">
                    <div class="school-logo" id="logo-team3" style="background: #461d7c;">LSU</div>
                    <div style="flex: 1;">
                        <div class="school-name" id="name-team3">LSU Tigers</div>
                        <div class="school-conf" id="conf-team3">SEC</div>
                        <select class="team-selector" id="selector-team3" onchange="updateTeam('team3', this.value)">
                            <optgroup label="SEC">
                                <option value="alabama">Alabama</option>
                                <option value="arkansas">Arkansas</option>
                                <option value="auburn">Auburn</option>
                                <option value="florida">Florida</option>
                                <option value="georgia">Georgia</option>
                                <option value="kentucky">Kentucky</option>
                                <option value="lsu" selected>LSU</option>
                                <option value="mississippi-state">Mississippi State</option>
                                <option value="missouri">Missouri</option>
                                <option value="oklahoma">Oklahoma</option>
                                <option value="ole-miss">Ole Miss</option>
                                <option value="south-carolina">South Carolina</option>
                                <option value="tennessee">Tennessee</option>
                                <option value="texas">Texas</option>
                                <option value="texas-am">Texas A&M</option>
                                <option value="vanderbilt">Vanderbilt</option>
                            </optgroup>
                            <optgroup label="Big Ten">
                                <option value="illinois">Illinois</option>
                                <option value="indiana">Indiana</option>
                                <option value="iowa">Iowa</option>
                                <option value="maryland">Maryland</option>
                                <option value="michigan">Michigan</option>
                                <option value="michigan-state">Michigan State</option>
                                <option value="minnesota">Minnesota</option>
                                <option value="nebraska">Nebraska</option>
                                <option value="northwestern">Northwestern</option>
                                <option value="ohio-state">Ohio State</option>
                                <option value="oregon">Oregon</option>
                                <option value="penn-state">Penn State</option>
                                <option value="purdue">Purdue</option>
                                <option value="rutgers">Rutgers</option>
                                <option value="usc">USC</option>
                                <option value="washington">Washington</option>
                                <option value="wisconsin">Wisconsin</option>
                            </optgroup>
                        </select>
                    </div>
                </div>
                <div class="misery-score">
                    <div class="misery-label">Season Misery Score</div>
                    <div class="misery-value high" id="score-team3">92</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Total Miles</div>
                        <div class="stat-value" id="miles-team3">29,140</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Flights Needed</div>
                        <div class="stat-value" id="flights-team3">12</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Est. Cost</div>
                        <div class="stat-value" id="cost-team3">$18,600</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Home Games</div>
                        <div class="stat-value" id="home-team3" style="color: var(--accent-red);">6  4h 锔</div>
                    </div>
                </div>
            </div>
        </section>

        <section class="map-section">
            <h2 class="section-title">Travel Map</h2>
            <div class="map-container">
                <div class="map-tabs">
                    <button class="map-tab active" data-team="all">All Teams</button>
                    <button class="map-tab" data-team="ucla">UCLA</button>
                    <button class="map-tab" data-team="team2" id="map-tab-team2">Texas</button>
                    <button class="map-tab" data-team="team3" id="map-tab-team3">LSU</button>
                </div>
                <div id="travelMap"></div>
                <div class="map-legend">
                    <div class="legend-item"><div class="legend-dot" style="background: #10b981;"></div><span>Chatsworth, CA (Hometown)</span></div>
                    <div class="legend-item"><div style="width: 20px; height: 3px; background: #9ca3af;"></div><span>Home Stadium (solid)</span></div>
                    <div class="legend-item"><div style="width: 20px; height: 2px; background: #9ca3af; border-style: dashed;"></div><span>Away Games (dashed)</span></div>
                </div>
                <div class="map-legend" style="margin-top: 0.5rem;" id="map-legend-teams">
                    <div class="legend-item"><div class="legend-dot" style="background: #2d68c4;"></div><span>UCLA</span></div>
                    <div class="legend-item"><div class="legend-dot" id="legend-team2" style="background: #bf5700;"></div><span id="legend-name-team2">Texas</span></div>
                    <div class="legend-item"><div class="legend-dot" id="legend-team3" style="background: #461d7c;"></div><span id="legend-name-team3">LSU</span></div>
                </div>
            </div>
        </section>

        <section class="charts-section">
            <h2 class="section-title">Visual Comparison</h2>
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-title">Season Misery Score</div>
                    <canvas id="miseryChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Season Cost by Game Type (2 people)</div>
                    <canvas id="costChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Miles by Game Type</div>
                    <canvas id="distanceChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Flights Required (Round Trips)</div>
                    <canvas id="timeChart"></canvas>
                </div>
            </div>
        </section>

        <section class="comparison-section">
            <div class="comparison-header">
                <div class="comparison-title">Head-to-Head Comparison</div>
                <div class="comparison-subtitle">Based on 2026 season schedules from Chatsworth, CA</div>
            </div>
            
            <div class="bar-comparison">
                <div class="bar-label">
                    <span>Total Season Miles (incl. home games)</span>
                    <span id="bar-label-miles">UCLA: 6,892 路 Texas: 22,280 路 LSU: 29,140</span>
                </div>
                <div class="bar-track" id="bar-miles"></div>
            </div>
            
            <div class="bar-comparison">
                <div class="bar-label">
                    <span>Estimated Season Cost (2 people, all games)</span>
                    <span id="bar-label-cost">UCLA: $4,200 路 Texas: $14,200 路 LSU: $18,600</span>
                </div>
                <div class="bar-track" id="bar-cost"></div>
            </div>
            
            <div class="bar-comparison">
                <div class="bar-label">
                    <span>Flights Required (Round Trips)</span>
                    <span id="bar-label-flights">UCLA: 4 路 Texas: 12 路 LSU: 12</span>
                </div>
                <div class="bar-track" id="bar-flights"></div>
            </div>
        </section>

        <section class="schedule-section">
            <h2 class="section-title">2026 Season Game Details</h2>
            <div class="schedule-tabs">
                <button class="tab-btn active" data-school="ucla">UCLA</button>
                <button class="tab-btn" data-school="team2" id="sched-tab-team2">Texas</button>
                <button class="tab-btn" data-school="team3" id="sched-tab-team3">LSU</button>
            </div>
            
            <div class="schedule-table" id="scheduleTable"></div>
        </section>

        <footer>
            <p>Misery Index Prototype 路 Data based on 2026 schedules 路 Costs are estimates for 2 people (flights + 1 night hotel)</p>
        </footer>
    </div>

    <script src="teams-data.js"></script>
    <script>
        // State
        let selectedTeams = {
            ucla: 'ucla',
            team2: 'texas',
            team3: 'lsu'
        };
        
        // Chart instances (for updates)
        let charts = {};
        
        // Home location
        const HOME = { lat: 34.2572, lng: -118.6006 };
        
        // Map state
        let map = null;
        let teamLayers = {};
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initMap();
            initCharts();
            updateAllDisplays();
            setupScheduleTabs();
            setupMapTabs();
        });
        
        function updateTeam(slot, teamId) {
            selectedTeams[slot] = teamId;
            updateAllDisplays();
            updateMap();
        }
        
        function updateAllDisplays() {
            // Update cards for team2 and team3
            ['team2', 'team3'].forEach(slot => {
                const teamId = selectedTeams[slot];
                const team = TEAMS[teamId];
                const stats = calculateTeamStats(teamId);
                
                document.getElementById(`logo-${slot}`).textContent = team.abbr;
                document.getElementById(`logo-${slot}`).style.background = team.color;
                document.getElementById(`name-${slot}`).textContent = `${team.name} ${team.mascot}`;
                document.getElementById(`conf-${slot}`).textContent = team.conference;
                
                const scoreEl = document.getElementById(`score-${slot}`);
                scoreEl.textContent = stats.miseryScore;
                scoreEl.className = 'misery-value ' + (stats.miseryScore < 40 ? 'low' : stats.miseryScore < 70 ? 'medium' : 'high');
                
                document.getElementById(`miles-${slot}`).textContent = stats.totalMiles.toLocaleString();
                document.getElementById(`flights-${slot}`).textContent = stats.flights;
                document.getElementById(`cost-${slot}`).textContent = '$' + stats.totalCost.toLocaleString();
                
                const homeInfo = getHomeGameInfo(teamId);
                const homeEl = document.getElementById(`home-${slot}`);
                homeEl.textContent = homeInfo.text;
                homeEl.style.color = homeInfo.color;
                
                // Update tab labels
                document.getElementById(`map-tab-${slot}`).textContent = team.name;
                document.getElementById(`sched-tab-${slot}`).textContent = team.name;
                document.getElementById(`legend-${slot}`).style.background = team.color;
                document.getElementById(`legend-name-${slot}`).textContent = team.name;
            });
            
            updateCharts();
            updateComparisonBars();
            renderSchedule('ucla'); // Reset to UCLA schedule
        }
        
        function calculateTeamStats(teamId) {
            const schedule = SCHEDULES[teamId];
            if (!schedule) return { totalMiles: 0, totalCost: 0, flights: 0, miseryScore: 0 };
            
            let totalMiles = 0;
            let totalCost = 0;
            let flights = 0;
            
            schedule.forEach(game => {
                const location = STADIUMS[game.location];
                if (location) {
                    totalMiles += location.distance * 2;
                    totalCost += location.cost;
                    if (location.distance > 100) flights++;
                }
            });
            
            // Score weighted: 40% miles, 30% cost, 30% flights (relative to max reasonable values)
            const miseryScore = Math.min(100, Math.round(
                (totalMiles / 30000 * 40) + 
                (totalCost / 20000 * 30) + 
                (flights / 12 * 30)
            ));
            
            return { totalMiles, totalCost, flights, miseryScore };
        }
        
        function getHomeGameInfo(teamId) {
            const stadium = STADIUMS[teamId];
            if (!stadium) return { text: '-', color: 'var(--text-secondary)' };
            
            if (stadium.distance < 100) {
                return { text: `${stadium.totalTime} `, color: 'var(--accent-green)' };
            } else {
                const schedule = SCHEDULES[teamId];
                const homeGames = schedule ? schedule.filter(g => g.type === 'home').length : 0;
                const flightTime = stadium.flight || '?h';
                return { 
                    text: `${homeGames}  ${flightTime.replace(' (1 stop)', '')} 锔`, 
                    color: stadium.distance > 1700 ? 'var(--accent-red)' : 'var(--accent-yellow)' 
                };
            }
        }
        
        // ==================== CHARTS ====================
        function initCharts() {
            const chartColors = ['rgba(45, 104, 196, 0.8)', 'rgba(191, 87, 0, 0.8)', 'rgba(70, 29, 124, 0.8)'];
            
            charts.misery = new Chart(document.getElementById('miseryChart'), {
                type: 'bar',
                data: {
                    labels: ['UCLA', 'Texas', 'LSU'],
                    datasets: [{ label: 'Misery Score', data: [24, 78, 92], backgroundColor: chartColors, borderRadius: 6 }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: 100, grid: { color: '#2d2d3a' }, ticks: { color: '#9ca3af' } },
                        x: { grid: { display: false }, ticks: { color: '#9ca3af' } }
                    }
                }
            });
            
            charts.cost = new Chart(document.getElementById('costChart'), {
                type: 'bar',
                data: {
                    labels: ['UCLA', 'Texas', 'LSU'],
                    datasets: [
                        { label: 'Home Games', data: [120, 5950, 5700], backgroundColor: 'rgba(16, 185, 129, 0.8)', borderRadius: 4 },
                        { label: 'Away Games', data: [3150, 4600, 5150], backgroundColor: 'rgba(239, 68, 68, 0.8)', borderRadius: 4 }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#9ca3af' } } },
                    scales: {
                        y: { stacked: true, beginAtZero: true, grid: { color: '#2d2d3a' }, ticks: { color: '#9ca3af', callback: v => '$' + v.toLocaleString() } },
                        x: { stacked: true, grid: { display: false }, ticks: { color: '#9ca3af' } }
                    }
                }
            });
            
            charts.distance = new Chart(document.getElementById('distanceChart'), {
                type: 'bar',
                data: {
                    labels: ['Home Games', 'Away Games'],
                    datasets: [
                        { label: 'UCLA', data: [150, 5345], backgroundColor: chartColors[0], borderRadius: 4 },
                        { label: 'Texas', data: [9800, 8380], backgroundColor: chartColors[1], borderRadius: 4 },
                        { label: 'LSU', data: [10800, 9930], backgroundColor: chartColors[2], borderRadius: 4 }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#9ca3af' } } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#2d2d3a' }, ticks: { color: '#9ca3af', callback: v => v.toLocaleString() + ' mi' } },
                        x: { grid: { display: false }, ticks: { color: '#9ca3af' } }
                    }
                }
            });
            
            charts.flights = new Chart(document.getElementById('timeChart'), {
                type: 'doughnut',
                data: {
                    labels: ['UCLA (4)', 'Texas (12)', 'LSU (12)'],
                    datasets: [{ data: [4, 12, 12], backgroundColor: chartColors, borderWidth: 0 }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'bottom', labels: { color: '#9ca3af' } } }
                }
            });
        }
        
        function updateCharts() {
            const teams = ['ucla', selectedTeams.team2, selectedTeams.team3];
            const stats = teams.map(t => calculateTeamStats(t));
            const names = teams.map(t => TEAMS[t].name);
            const colors = [TEAMS.ucla.color, TEAMS[selectedTeams.team2].color, TEAMS[selectedTeams.team3].color].map(c => c + 'cc');
            
            // Update misery chart
            charts.misery.data.labels = names;
            charts.misery.data.datasets[0].data = stats.map(s => s.miseryScore);
            charts.misery.data.datasets[0].backgroundColor = colors;
            charts.misery.update();
            
            // Update cost chart
            charts.cost.data.labels = names;
            const homeCosts = teams.map(t => {
                const schedule = SCHEDULES[t];
                if (!schedule) return 0;
                return schedule.filter(g => g.type === 'home').reduce((sum, g) => sum + (STADIUMS[g.location]?.cost || 0), 0);
            });
            const awayCosts = teams.map(t => {
                const schedule = SCHEDULES[t];
                if (!schedule) return 0;
                return schedule.filter(g => g.type !== 'home').reduce((sum, g) => sum + (STADIUMS[g.location]?.cost || 0), 0);
            });
            charts.cost.data.datasets[0].data = homeCosts;
            charts.cost.data.datasets[1].data = awayCosts;
            charts.cost.update();
            
            // Update distance chart
            charts.distance.data.datasets.forEach((ds, i) => {
                ds.label = names[i];
                ds.backgroundColor = colors[i];
                const schedule = SCHEDULES[teams[i]];
                if (schedule) {
                    const homeMiles = schedule.filter(g => g.type === 'home').reduce((sum, g) => sum + (STADIUMS[g.location]?.distance || 0) * 2, 0);
                    const awayMiles = schedule.filter(g => g.type !== 'home').reduce((sum, g) => sum + (STADIUMS[g.location]?.distance || 0) * 2, 0);
                    ds.data = [homeMiles, awayMiles];
                }
            });
            charts.distance.update();
            
            // Update flights chart
            charts.flights.data.labels = names.map((n, i) => `${n} (${stats[i].flights})`);
            charts.flights.data.datasets[0].data = stats.map(s => s.flights);
            charts.flights.data.datasets[0].backgroundColor = colors;
            charts.flights.update();
        }
        
        function updateComparisonBars() {
            const teams = ['ucla', selectedTeams.team2, selectedTeams.team3];
            const stats = teams.map(t => calculateTeamStats(t));
            const names = teams.map(t => TEAMS[t].name);
            const colors = [TEAMS.ucla.color, TEAMS[selectedTeams.team2].color, TEAMS[selectedTeams.team3].color];
            
            // Miles bar
            const totalMiles = stats.reduce((sum, s) => sum + s.totalMiles, 0);
            document.getElementById('bar-label-miles').textContent = names.map((n, i) => `${n}: ${stats[i].totalMiles.toLocaleString()}`).join(' 路 ');
            document.getElementById('bar-miles').innerHTML = stats.map((s, i) => 
                `<div class="bar-segment" style="width: ${(s.totalMiles / totalMiles * 100).toFixed(0)}%; background: ${colors[i]};">${names[i]}</div>`
            ).join('');
            
            // Cost bar
            const totalCost = stats.reduce((sum, s) => sum + s.totalCost, 0);
            document.getElementById('bar-label-cost').textContent = names.map((n, i) => `${n}: $${stats[i].totalCost.toLocaleString()}`).join(' 路 ');
            document.getElementById('bar-cost').innerHTML = stats.map((s, i) => 
                `<div class="bar-segment" style="width: ${(s.totalCost / totalCost * 100).toFixed(0)}%; background: ${colors[i]};">${names[i]}</div>`
            ).join('');
            
            // Flights bar
            const totalFlights = stats.reduce((sum, s) => sum + s.flights, 0);
            document.getElementById('bar-label-flights').textContent = names.map((n, i) => `${n}: ${stats[i].flights}`).join(' 路 ');
            document.getElementById('bar-flights').innerHTML = stats.map((s, i) => 
                `<div class="bar-segment" style="width: ${(s.flights / totalFlights * 100).toFixed(0)}%; background: ${colors[i]};">${names[i]}</div>`
            ).join('');
        }
        
        // ==================== SCHEDULE ====================
        function setupScheduleTabs() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const school = btn.dataset.school;
                    const teamId = school === 'ucla' ? 'ucla' : selectedTeams[school];
                    renderSchedule(teamId);
                });
            });
        }
        
        function renderSchedule(teamId) {
            const schedule = SCHEDULES[teamId];
            if (!schedule) {
                document.getElementById('scheduleTable').innerHTML = '<div style="padding: 2rem; text-align: center; color: var(--text-secondary);">Schedule not available</div>';
                return;
            }
            
            let totalCost = 0;
            let flights = 0;
            
            let html = `
                <div class="schedule-row header">
                    <div>Date</div>
                    <div>Opponent</div>
                    <div>To Airport</div>
                    <div>Flight</div>
                    <div>To Stadium</div>
                    <div>Total</div>
                    <div>Cost</div>
                </div>
            `;
            
            schedule.forEach(game => {
                const location = STADIUMS[game.location];
                if (!location) return;
                
                const isLocal = location.distance < 100;
                totalCost += location.cost;
                if (!isLocal) flights++;
                
                const toAirport = isLocal ? '-' : '45 min to LAX';
                const totalTime = location.totalTime || '-';
                const totalHours = parseFloat(totalTime) || 0;
                
                html += `
                    <div class="schedule-row" style="${isLocal ? 'opacity: 0.7;' : ''}">
                        <div>${game.date}</div>
                        <div class="opponent-cell">
                            ${game.type === 'away' ? '<span class="away-badge">AWAY</span>' : 
                              game.type === 'neutral' ? '<span class="neutral-badge">NEUTRAL</span>' :
                              '<span class="home-badge">HOME</span>'}
                            ${game.opponent}
                        </div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">${toAirport}</div>
                        <div style="font-size: 0.75rem;">${location.flight || '-'}</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">${location.toStadium || '-'}</div>
                        <div style="font-weight: 600; color: ${isLocal ? 'var(--accent-green)' : totalHours > 7 ? 'var(--accent-red)' : 'var(--accent-yellow)'};">${totalTime}</div>
                        <div>$${location.cost}</div>
                    </div>
                `;
            });
            
            html += `
                <div class="schedule-row" style="background: var(--bg-secondary); font-weight: 600;">
                    <div></div>
                    <div>SEASON TOTAL</div>
                    <div style="grid-column: span 3; text-align: center;">${flights} flights required</div>
                    <div></div>
                    <div>$${totalCost.toLocaleString()}</div>
                </div>
            `;
            
            document.getElementById('scheduleTable').innerHTML = html;
        }
        
        // ==================== MAP ====================
        function initMap() {
            map = L.map('travelMap', { center: [38, -98], zoom: 4, attributionControl: false });
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { maxZoom: 19 }).addTo(map);
            
            // Home marker
            const homeIcon = L.divIcon({
                html: '<div style="width: 16px; height: 16px; background: #10b981; border-radius: 50%; border: 3px solid #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.5);"></div>',
                iconSize: [16, 16], iconAnchor: [8, 8]
            });
            L.marker([HOME.lat, HOME.lng], { icon: homeIcon }).bindPopup('<strong>Chatsworth, CA</strong><br>Hometown').addTo(map);
            
            updateMap();
        }
        
        function setupMapTabs() {
            document.querySelectorAll('.map-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.map-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const team = tab.dataset.team;
                    
                    Object.keys(teamLayers).forEach(t => {
                        if (team === 'all' || t === team) {
                            map.addLayer(teamLayers[t]);
                        } else {
                            map.removeLayer(teamLayers[t]);
                        }
                    });
                });
            });
        }
        
        function updateMap() {
            // Clear existing layers
            Object.values(teamLayers).forEach(layer => map.removeLayer(layer));
            teamLayers = {};
            
            const teams = { ucla: 'ucla', team2: selectedTeams.team2, team3: selectedTeams.team3 };
            
            Object.entries(teams).forEach(([slot, teamId]) => {
                const team = TEAMS[teamId];
                const schedule = SCHEDULES[teamId];
                const homeStadium = STADIUMS[teamId];
                if (!team || !schedule || !homeStadium) return;
                
                const color = team.color;
                const layer = L.layerGroup();
                const isLocal = homeStadium.distance < 100;
                
                // Home stadium line
                if (homeStadium.lat) {
                    layer.addLayer(L.polyline(createArc([HOME.lat, HOME.lng], [homeStadium.lat, homeStadium.lng], 20), 
                        { color, weight: isLocal ? 2 : 4, opacity: isLocal ? 0.4 : 0.8 }));
                    
                    const stadiumIcon = L.divIcon({
                        html: `<div style="width: ${isLocal ? 12 : 16}px; height: ${isLocal ? 12 : 16}px; background: ${color}; border-radius: 3px; border: 2px solid #fff; transform: rotate(45deg);"></div>`,
                        iconSize: [16, 16], iconAnchor: [8, 8]
                    });
                    layer.addLayer(L.marker([homeStadium.lat, homeStadium.lng], { icon: stadiumIcon }).bindPopup(`<strong>${homeStadium.name}</strong><br>Home Stadium`));
                }
                
                // Away games
                schedule.forEach(game => {
                    if (game.type === 'home') return;
                    const location = STADIUMS[game.location];
                    if (!location || !location.lat) return;
                    
                    layer.addLayer(L.polyline(createArc([HOME.lat, HOME.lng], [location.lat, location.lng], 20), 
                        { color, weight: 2, opacity: 0.6, dashArray: '5, 10' }));
                    
                    const destIcon = L.divIcon({
                        html: `<div style="width: 10px; height: 10px; background: ${color}; border-radius: 50%; border: 2px solid #fff;"></div>`,
                        iconSize: [10, 10], iconAnchor: [5, 5]
                    });
                    layer.addLayer(L.marker([location.lat, location.lng], { icon: destIcon }).bindPopup(`<strong>${location.name}</strong><br>Away Game`));
                });
                
                teamLayers[slot] = layer;
                layer.addTo(map);
            });
        }
        
        function createArc(start, end, n) {
            const pts = [];
            for (let i = 0; i <= n; i++) {
                const t = i / n;
                const lat = start[0] + (end[0] - start[0]) * t + Math.sin(t * Math.PI) * 1.5;
                const lng = start[1] + (end[1] - start[1]) * t;
                pts.push([lat, lng]);
            }
            return pts;
        }
    </script>
</body>
</html>
